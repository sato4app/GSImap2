# 国土地理院 地形図ビューア 利用者の手引

**バージョン**: 2025年8月版  
**対象アプリケーション**: GSImap2

## 目次

1. [概要](#1-概要)
2. [基本操作](#2-基本操作)
3. [画像オーバーレイ機能](#3-画像オーバーレイ機能)
4. [画像の編集操作](#4-画像の編集操作)
5. [GPSデータの読み込み](#5-gpsデータの読み込み)
6. [GeoJSONデータの読み込み](#6-geojsonデータの読み込み)
7. [トラブルシューティング](#7-トラブルシューティング)

## 1. 概要

国土地理院 地形図ビューアは、国土地理院の地図を背景に、PNG画像をオーバーレイ表示し、直感的に操作できるWebアプリケーションです。

### 主な機能
- 国土地理院の詳細地図表示
- PNG画像の重ね合わせ表示
- マウスによる画像の移動・リサイズ
- ExcelファイルからのGPSデータ読み込み
- GeoJSONファイルの地理データ表示

## 2. 基本操作

### 2.1. アプリケーションの起動

1. Webブラウザで `index.html` を開きます
2. 地図が表示され、箕面大滝（大阪府）を中心とした地図が表示されます
3. 画面右上に操作パネルが表示されます

### 2.2. 地図の操作

- **移動**: 地図をドラッグして表示範囲を移動
- **ズーム**: マウスホイールまたはズームボタンで拡大・縮小
- **スケール**: 右下にメートル/キロメートル単位のスケールバーを表示

### 2.3. 中心座標の設定

1. **中心座標**ボタンをクリック
2. ボタンがアクティブ（押し込み）状態になり、マウスカーソルが十字型に変化
3. 地図上の任意の場所をクリック
4. 赤い円形マーカーが新しい位置に移動
5. **北緯**・**東経**欄に座標が表示されます

## 3. 画像オーバーレイ機能

### 3.1. 画像の読み込み

1. **画像読込**ボタンをクリック
2. ファイル選択ダイアログでPNG画像を選択
3. 画像が地図の中心（赤いマーカー位置）に表示されます

### 3.2. 表示設定の調整

#### 表示倍率
- **初期値**: 0.3（地図幅の30%）
- **調整方法**: 数値入力欄で0.1以上の値を設定
- **効果**: 値を大きくすると画像が大きく表示されます

#### 透過度
- **初期値**: 50%
- **調整範囲**: 0%（完全透明）〜 100%（完全不透明）
- **効果**: 地図と画像の重なり具合を調整できます

## 4. 画像の編集操作

### 4.1. 画像のリサイズ

画像が表示されると、四隅に**赤い円形ハンドル**が表示されます。

#### ハンドルの操作方法
1. マウスポインタをハンドルに近づける
2. ハンドルが拡大し、「ドラッグしてサイズ変更」のツールチップが表示
3. マウスカーソルがリサイズアイコンに変化
4. ハンドルをドラッグして画像サイズを変更

#### リサイズの特徴
- **縦横比保持**: 画像の縦横比は自動的に維持されます
- **倍率同期**: ドラッグ操作に合わせて「表示倍率」が自動更新されます
- **リアルタイム表示**: ドラッグ中は画像中央に現在の倍率が表示されます

### 4.2. 画像の移動

#### 移動操作の方法
1. 中心座標マーカー（赤い円）にマウスポインタを近づける
2. マーカーが拡大し、「ドラッグして画像移動」のツールチップが表示
3. マウスカーソルが移動アイコンに変化
4. マーカーをドラッグして画像を新しい位置に移動

#### 移動の特徴
- **画像全体移動**: 画像とハンドルが一緒に移動します
- **サイズ保持**: 画像のサイズと縦横比は変更されません
- **座標更新**: **北緯**・**東経**の表示が自動的に更新されます
- **表示優先度**: 中心座標マーカーはGPSマーカーより上に表示され、操作時に隠れません

## 5. GPSデータの読み込み

### 5.1. Excelファイルの準備

以下の形式でExcelファイル（.xlsx）を準備してください：

| A列 | B列 | C列（名称前半） | D列（緯度） | E列（経度） | F列 | G列（名称後半） |
|-----|-----|----------------|-------------|-------------|-----|----------------|
| ... | ... | 箕面        | 34502066    | 135274106   | ... | 大滝       |

#### データ形式の詳細
- **C列**: 地点名の前半部分
- **D列**: 緯度（度分秒形式、8文字）
- **E列**: 経度（度分秒形式、9文字）
- **G列**: 地点名の後半部分
- **1行目**: ヘッダー行（読み飛ばされます）

#### 度分秒形式の例
- **緯度**: `34502066` → 34度50分20.66秒
- **経度**: `135274106` → 135度27分41.06秒

### 5.2. データの読み込み

1. **GPS値読込**ボタンをクリック
2. Excelファイル（.xlsx）を選択
3. 地図上に青色のマーカーが表示されます
4. マーカーをクリックすると地点名がポップアップ表示されます

## 6. GeoJSONデータの読み込み

### 6.1. 対応データ形式

- **ファイル形式**: .geojson または .json
- **対応ジオメトリ**:
  - Point（ポイント）: 円形マーカーで表示
  - LineString（線）: オレンジ色の線で表示
  - Polygon（面）: オレンジ色の枠線のみ表示

### 6.2. データの読み込み

1. **GeoJSON読込**ボタンをクリック
2. GeoJSONファイルを選択
3. 地理データが地図上にオレンジ色で表示されます
4. `properties.name` がある要素はクリックで名称を表示

## 7. トラブルシューティング

### 7.1. 画像関連の問題

#### 画像が表示されない
- **原因**: PNG形式以外のファイル、または破損したファイル
- **解決方法**: 有効なPNGファイルを選択し直してください

#### 画像のサイズが異常
- **原因**: 表示倍率の設定値が不適切
- **解決方法**: 表示倍率を0.1〜1.0の範囲で調整してください

#### ハンドルが表示されない
- **原因**: 画像が正しく読み込まれていない
- **解決方法**: 画像を再度読み込んでください

### 7.2. マウス操作の問題

#### カーソルが元に戻らない
- **解決方法**: 
  - ページを再読み込みしてください
  - 別の場所をクリックしてください

#### ドラッグ操作が効かない
- **原因**: ブラウザの互換性問題
- **解決方法**: 
  - Chrome、Firefox、Safari等の最新ブラウザをご利用ください
  - ページを再読み込みしてください

### 7.3. データ読み込みの問題

#### GPSデータが読み込めない
- **確認事項**:
  - ファイルが.xlsx形式であること
  - D列・E列に度分秒形式の数値が入力されていること
  - 1行目がヘッダー行になっていること

#### GeoJSONデータが表示されない
- **確認事項**:
  - ファイルが有効なJSON形式であること
  - GeoJSON仕様に準拠していること
  - 座標系がWGS84（EPSG:4326）であること

### 7.4. 一般的な問題

#### 動作が重い
- **解決方法**:
  - 大きすぎる画像ファイルは事前にリサイズしてください
  - 不要なマーカーやデータをクリアしてください
  - ブラウザのタブを減らしてください

#### 表示が崩れる
- **解決方法**:
  - ブラウザを最新版に更新してください
  - ページを再読み込みしてください
  - キャッシュをクリアしてください

---

## 操作のコツ

### 効率的な画像配置
1. まず「中心座標」で大まかな位置を設定
2. 画像を読み込み
3. ドラッグで微調整
4. ハンドルでサイズ調整

### 複数データの活用
- GPSデータで基準点を表示
- 画像で詳細情報を重ね合わせ
- GeoJSONで境界線や領域を表示

### 表示の最適化
- 透過度50-70%で地図と画像のバランスを調整
- 表示倍率0.2-0.5で全体を把握
- 必要に応じてズームレベルを調整

---

## 更新履歴

### 2025年8月版の改善点
- **表示優先度の改善**: 中心座標マーカーがGPSマーカーより上に表示されるように修正
- **レイヤー管理の最適化**: ドラッグハンドルの表示優先度を改善
- **依存関係の最適化**: ライブラリの読み込み順序を改善し、動作の安定性を向上
- **操作性の向上**: マーカーが他の要素に隠れることなく確実に操作可能

---

**最終更新**: 2025年8月3日  
**お問い合わせ**: 本アプリケーションに関するご質問は開発者までお寄せください。