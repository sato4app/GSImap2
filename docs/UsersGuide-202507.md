# 国土地理院 地形図ビューア 利用の手引

## 目次
1. [概要](#概要)
2. [起動方法](#起動方法)
3. [基本操作](#基本操作)
4. [画像オーバーレイ機能](#画像オーバーレイ機能)
5. [GPSデータ読み込み機能](#gpsデータ読み込み機能)
6. [GeoJSONデータ読み込み機能](#geojsonデータ読み込み機能)
7. [トラブルシューティング](#トラブルシューティング)

## 概要

国土地理院地形図ビューアは、国土地理院の地図を背景に、ユーザーが任意の画像を重ねて表示したり、GPSデータやGeoJSONデータを地図上に表示できるWebアプリケーションです。

### 主な機能
- 国土地理院の標準地図を表示
- PNG画像のオーバーレイ表示（サイズ・透過度調整可能）
- ExcelファイルからのGPSデータ読み込み
- GeoJSONファイルからの地理データ読み込み
- 地図上の任意の位置にマーカー設置

## 起動方法

1. `index.html`ファイルをWebブラウザで開く
2. アプリケーションが起動し、箕面大滝周辺の地図が表示される
3. 画面右上に操作コントロールが表示される

## 基本操作

### 地図の操作
- **ズーム**: マウスホイールまたは地図上の+/-ボタン
- **移動**: マウスドラッグ
- **中心座標の確認**: 画面右上の「北緯」「東経」欄で現在の中心座標を確認

### 中心座標の設定
1. 「中心座標」ボタンをクリック
2. ボタンがアクティブ状態（押し込み状態）になる
3. 地図上で設定したい位置をクリック
4. マーカーが設置され、地図の中心が移動
5. モードが自動的に解除される

## 画像オーバーレイ機能

### 画像の読み込み
1. 「画像読込」ボタンをクリック
2. ファイル選択ダイアログが開く
3. PNG画像ファイルを選択
4. 画像が地図の中心に表示される

### 画像の調整
- **表示倍率**: 0.1以上の値を入力（初期値: 0.3）
  - 値が大きいほど画像が大きく表示される
  - 地図の表示領域の幅に対する画像の幅の比率
- **透過度**: 0〜100の値を入力（初期値: 50）
  - 0%: 完全に透明
  - 100%: 完全不透明

### 注意事項
- 対応ファイル形式: PNG画像のみ
- 画像の縦横比は自動的に維持される
- 新しい画像を読み込むと、既存の画像は置き換えられる
- 「中心座標」ボタンをクリックすると、表示中の画像が削除される

## GPSデータ読み込み機能

### 対応ファイル形式
- Excelファイル (.xlsx)

### ファイル形式の仕様
Excelファイルの最初のシートを使用し、以下の列構成が必要です：

| 列 | 内容 | 形式 |
|---|---|---|
| C列 | 地点名の前半部分 | テキスト |
| D列 | 緯度 | 度分秒形式（8文字） |
| E列 | 経度 | 度分秒形式（9文字） |
| G列 | 地点名の後半部分 | テキスト |

### 度分秒形式の例
- **緯度**: "34502066" → 34度50分20.66秒
- **経度**: "135274106" → 135度27分41.06秒

### 読み込み手順
1. 「GPS値読込」ボタンをクリック
2. Excelファイルを選択
3. 地図上にマーカーが表示される
4. マーカーをクリックすると地点名がポップアップ表示される

### 注意事項
- 1行目はヘッダーとして扱われる（2行目以降がデータ）
- 緯度・経度が0以下の行はスキップされる
- 地点名が空の行はスキップされる
- 読み込み件数はコンソールに出力される

## GeoJSONデータ読み込み機能

### 対応ファイル形式
- GeoJSONファイル (.geojson)
- JSONファイル (.json)

### 対応ジオメトリタイプ
- **Point**: ポイントデータ（円形マーカーで表示）
- **LineString**: ライン（線）データ（オレンジ色の線で表示）
- **Polygon**: ポリゴン（面）データ（枠線のみ表示、内部は塗りつぶさない）

### 読み込み手順
1. 「GeoJSON読込」ボタンをクリック
2. GeoJSONファイルを選択
3. 地図上に地理データが表示される
4. 各要素をクリックすると、`properties.name`が存在する場合はポップアップ表示される

### 表示仕様
- **Point**: 半径6pxの円形マーカー（オレンジ色）
- **LineString**: 太さ2pxの線（オレンジ色）
- **Polygon**: 太さ2pxの枠線（オレンジ色）、内部は透明

### 注意事項
- GeoJSON標準仕様に準拠したファイルが必要
- 文字コードはUTF-8を推奨
- 無効なJSON形式の場合はエラーメッセージが表示される

## トラブルシューティング

### よくある問題と解決方法

#### 画像が表示されない
- **原因**: ファイル形式がPNG以外
- **解決方法**: PNG画像ファイルを使用してください

#### GPSデータが読み込まれない
- **原因1**: Excelファイルの列構成が正しくない
- **解決方法**: C列、D列、E列、G列に正しいデータが入っているか確認
- **原因2**: 度分秒形式が正しくない
- **解決方法**: 緯度は8文字、経度は9文字の形式で入力

#### GeoJSONファイルが読み込まれない
- **原因**: ファイルが有効なGeoJSON形式でない
- **解決方法**: GeoJSON標準仕様に準拠したファイルを使用

#### 地図が表示されない
- **原因**: インターネット接続がない
- **解決方法**: インターネット接続を確認（国土地理院の地図タイルを使用）

#### ボタンが表示されない
- **原因**: CSSの読み込みに問題がある
- **解決方法**: ブラウザを再読み込み、または別のブラウザで試行

### エラーメッセージの意味

#### 「有効な画像ファイルではありません」
- PNG以外のファイル形式を選択した場合に表示
- PNG画像ファイルを選択してください

#### 「画像の読み込みに失敗しました」
- ファイルが破損している可能性
- 別の画像ファイルを試してください

#### 「GeoJSONファイルの読み込みに失敗しました」
- ファイルが有効なJSON形式でない
- 正しいGeoJSONファイルを選択してください

### パフォーマンスに関する注意
- 大きな画像ファイル（10MB以上）は読み込みに時間がかかる場合があります
- 大量のGPSデータ（1000件以上）は表示に時間がかかる場合があります
- 大きなGeoJSONファイルはブラウザの処理能力に応じて表示が遅くなる場合があります

## 技術情報

### 使用ライブラリ
- **Leaflet.js**: 地図表示とインタラクション
- **SheetJS**: Excelファイル読み込み

### 対応ブラウザ
- Chrome 80以上
- Firefox 75以上
- Safari 13以上
- Edge 80以上

### ファイルサイズ制限
- 画像ファイル: 50MB以下推奨
- Excelファイル: 10MB以下推奨
- GeoJSONファイル: 5MB以下推奨

---

**バージョン**: 2025年7月版  
**最終更新**: 2025年7月